# 공학용 계산기 설계 계획

## 1. 요구 사항 요약
- **지원 연산**: 사칙연산, 삼각함수(각도/라디안 전환), 로그, 지수, 다항식 미분/적분.
- **사용자 인터페이스**: 일반 사용자가 쉽게 사용할 수 있는 데스크톱 GUI.
- **배포 형태**: 로컬 PC에서 실행 가능한 단독 실행 파일(PyInstaller 등 추후 패키징 고려).
- **확장성**: 연산 모듈과 UI 구성 요소가 쉽게 확장될 수 있도록 모듈화된 구조.

## 2. 전체 구조 개요
```
project_root/
├─ app.py                  # GUI 진입점
├─ calculator/             # 계산 엔진 계층
│  ├─ __init__.py
│  ├─ engine.py            # 입력 검증, 연산 분배, 설정 관리
│  ├─ context.py           # 각도 단위, 정밀도 등 상태 관리
│  ├─ dispatcher.py        # 토큰화 및 연산 모듈 분배
│  ├─ basic/
│  │  ├─ __init__.py
│  │  └─ operations.py     # 사칙연산 및 상수 처리
│  ├─ scientific/
│  │  ├─ __init__.py
│  │  └─ operations.py     # 삼각함수, 로그, 지수
│  ├─ calculus/
│  │  ├─ __init__.py
│  │  └─ operations.py     # 다항식 미분/적분 (SymPy 활용)
│  └─ exceptions.py        # 커스텀 예외 정의
├─ ui/                     # GUI 계층(PyQt5 기반 권장)
│  ├─ __init__.py
│  ├─ main_window.py       # 메인 윈도우, 신호 연결, 상태 표시
│  ├─ keypad.py            # 숫자/연산 버튼 패널
│  ├─ menus.py             # 설정/도움말 메뉴
│  ├─ dialogs.py           # 각도/정밀도 설정, 오류 안내
│  └─ resources/           # 아이콘, 스타일, 번역 리소스
├─ services/               # 애플리케이션 계층
│  ├─ history.py           # 계산 기록 저장/조회
│  ├─ settings.py          # 사용자 설정 로드/저장(JSON)
│  └─ exporters.py         # 결과 내보내기 확장 포인트(향후)
├─ tests/
│  ├─ __init__.py
│  ├─ test_basic.py
│  ├─ test_scientific.py
│  ├─ test_calculus.py
│  └─ test_engine.py
├─ docs/
│  ├─ overview.md
│  ├─ user_guide.md
│  └─ design_plan.md       # (현재 문서) 설계 계획
└─ setup/
   ├─ README.md
   └─ packaging.md         # exe 패키징 가이드(추후)
```

## 3. 계층별 책임
- **계산 엔진(`calculator/`)**: 입력 검증, 연산 모듈 호출, 상태(각도 단위/정밀도) 관리, 오류 처리.
- **서비스 계층(`services/`)**: 히스토리, 설정, 향후 내보내기 등의 애플리케이션 보조 기능.
- **GUI(`ui/`)**: 사용자 입력 수집, 엔진 호출, 결과/오류 표시, 상태 제어(각도, 정밀도, 기록 등).
- **진입점(`app.py`)**: 애플리케이션 초기화, 전역 설정 로드, 메인 윈도우 실행.

## 4. 연산 모듈 상세
| 모듈 | 핵심 기능 | 주요 고려사항 |
|------|-----------|----------------|
| `basic.operations` | 덧셈, 뺄셈, 곱셈, 나눗셈 | 0으로 나누기 방지, 큰 수 처리, 정밀도 반영 |
| `scientific.operations` | sin, cos, tan, 역삼각함수, 로그(밑 변경), 지수 | 각도 단위 변환, 입력 범위 검증, 특이점 처리 |
| `calculus.operations` | 다항식 미분/적분 | SymPy 파서 사용, 사용자 입력 검증, 결과 포맷 관리 |

## 5. 데이터 흐름
1. 사용자가 GUI에서 수식/버튼을 입력한다.
2. UI는 입력을 `dispatcher`에 전달하여 토큰화 및 연산 종류를 판별한다.
3. `engine`은 현재 컨텍스트(각도 단위, 정밀도)를 참고하여 적절한 연산 모듈을 호출한다.
4. 연산 모듈이 결과를 반환하면 포맷팅 후 UI에 전달하고, 히스토리에 기록한다.
5. 오류 발생 시 커스텀 예외를 통해 UI에 메시지를 전달하고, 사용자에게 안내한다.

## 6. 단계별 Task 및 Checkpoint
### Phase 1 – 설계 확정
- **Task 1.1**: 요구 사항 및 제약 조건 최종 확인.
- **Task 1.2**: 데이터 흐름 다이어그램 및 UI 와이어프레임 초안 작성.
- **Task 1.3**: 연산 모듈 인터페이스 정의.
- **Checkpoint A**: 설계 문서 리뷰 및 승인.

### Phase 2 – 프로젝트 골격 구성
- **Task 2.1**: 제안된 디렉터리/패키지 구조 생성.
- **Task 2.2**: `requirements.txt`에 핵심 의존성(PyQt5, SymPy 등) 명시.
- **Task 2.3**: `app.py`에 GUI 초기화 스켈레톤 작성.
- **Checkpoint B**: 구조 및 초기 실행 로그 확인.

### Phase 3 – 계산 엔진 구현
- **Task 3.1**: `calculator.engine` 기본 구조와 컨텍스트 관리 구현.
- **Task 3.2**: 사칙연산 모듈 구현 및 단위 테스트.
- **Task 3.3**: 과학 연산 모듈 구현 및 단위 테스트.
- **Task 3.4**: 미적분 모듈 구현 및 단위 테스트.
- **Task 3.5**: 공용 예외/검증 로직 정리.
- **Checkpoint C**: 콘솔/단위 테스트 결과 공유.

### Phase 4 – GUI 및 서비스 계층 구현
- **Task 4.1**: 히스토리/설정 서비스 기본 구현.
- **Task 4.2**: GUI 레이아웃 및 이벤트 핸들러 작성.
- **Task 4.3**: 엔진과 GUI 연동, 오류 처리/상태 표시.
- **Task 4.4**: 사용자 설정(각도 단위, 정밀도) 대화상자 구현.
- **Checkpoint D**: GUI 프로토타입 시연/스크린샷 검토.

### Phase 5 – 테스트 및 문서화
- **Task 5.1**: 통합 테스트/회귀 테스트 추가.
- **Task 5.2**: 사용자 가이드 및 FAQ 작성.
- **Task 5.3**: 설계 문서 업데이트 및 유지보수 가이드 작성.
- **Checkpoint E**: 테스트 보고 및 문서 리뷰.

### Phase 6 – 패키징 및 배포
- **Task 6.1**: PyInstaller 스크립트 작성 및 exe 빌드.
- **Task 6.2**: 빌드 검증 및 실행 테스트.
- **Task 6.3**: 배포 절차 문서화.
- **Checkpoint F**: 배포 아티팩트 및 검증 결과 확인.

## 7. 향후 확장 고려 사항
- 플러그인 형태의 연산 모듈 등록 시스템.
- 고급 기능(복소수, 행렬 연산 등) 추가를 위한 인터페이스 확장.
- 다국어 UI 지원 및 접근성 개선.
- 클라우드 동기화나 모바일 앱과의 연동 가능성 검토.

본 설계 계획은 이후 단계에서 세부 구현에 따라 조정될 수 있으며, 각 Checkpoint에서 사용자 확인을 거쳐 진행합니다.
